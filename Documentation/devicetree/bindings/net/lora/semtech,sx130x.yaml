# SPDX-License-Identifier: (GPL-2.0 OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/net/lora/semtech,sx130x.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Semtech LoRa concentrator

maintainers:
  - Andreas FÃ¤rber <afaerber@suse.de>
  - Ben Whitten <ben.whitten@gmail.com>

description: |
  Semtech LoRa concentrator SX130x digital baseband chip is capable of
  demodulating LoRa signals on 8 channels simultaneously.

  It is typically paired with two SX125x IQ radios controlled over an
  SPI directly from the concentrator.

  The concentrator itself is controlled over SPI.

properties:
  compatible:
    oneOf:
      - items:
        - enum:
          - semtech,sx1308
        - const: semtech,sx1301
      - items:
        - const: semtech,sx1301

  reg:
    maxItems: 1
    description: The chip select on the SPI bus.

  reset-gpios:
    maxItems: 1
    description: A connection of the reset gpio line.

  semtech,power-lut:
    description: Power lookup table for the concentrator.
    allOf:
      - $ref: "/schemas/types.yaml#/definitions/uint8-matrix"
      - maxItems: 16
        items:
          items:
            - description: Power in dBm measured at the rf connector.
#              minimum: -6
#              maximum: 27
            - description: Digital gain.
              minimum: 0
              maximum: 3
            - description: PA gain.
              minimum: 0
              maximum: 3
            - description: DAC gain.
              minimum: 3
              maximum: 3
            - description: Mixer gain.
              minimum: 8
              maximum: 15

  radio-spi:
    type: object
    description: The concentrator can have two radios connected which are
      contained within the following node.

    properties:
      '#address-cells':
        const: 1

      '#size-cells':
        const: 0

    patternProperties:
      "^radio@[0-1]$":
        type: object
        properties:
          reg:
            maxItems: 1
            minimum: 0
            maximum: 1
        required:
          - reg

    required:
      - '#address-cells'
      - '#size-cells'

required:
  - compatible
  - reg

examples:
  - |

    #include <dt-bindings/gpio/gpio.h>

    spi {
      #address-cells = <1>;
      #size-cells = <0>;

      concentrator0: lora@0 {
        compatible = "semtech,sx1301";
        reg = <0>;
        reset-gpios = <&pioB 27 GPIO_ACTIVE_HIGH>;
        spi-max-frequency = <8000000>;

        semtech,power-lut = /bits/ 8 < 0xFD 0 0 3  9 >,
                                     <    3 0 0 3 12 >,
                                     <    4 0 0 3 13 >;

        radio-spi {
          #address-cells = <1>;
          #size-cells = <0>;

          radio0: radio@0 {
            compatible = "semtech,sx1257";
            reg = <0>;
          };

          radio1: radio@1 {
            compatible = "semtech,sx1257";
            reg = <1>;
          };
        };
      };
    };
